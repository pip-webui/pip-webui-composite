!function(){"use strict";angular.module("pipComposite",["pipContentSwitch","pipChecklistEdit","pipChecklistView","pipCompositeEdit","pipCompositeView","pipCompositeSummary","pipCompositeToolbar","pipCompositeFocused","pipMobileMouseup","pipMobileMousedown"])}(),function(e){try{e=angular.module("pipComposite.Templates")}catch(t){e=angular.module("pipComposite.Templates",[])}e.run(["$templateCache",function(e){e.put("checklist_edit/checklist_edit.html",'<div ng-class="{\'pip-checklist-draggable\': selected.drag}" id="{{\'checklist-\' + selected.id}}"><div ng-repeat="item in checklistContent" ng-mousedown="onClick($event, $index)" class="pip-checklist-item" id="{{\'check-item-\' + selected.id + \'-\' + $index}}" pip-drag="checklistContent.length > 1 && selected.drag && !item.empty" pip-drag-data="item" pip-force-touch="true" pip-touch-delay="30" pip-drop="true" pip-drag-stop="onStop(selected.id)" pip-drag-start="onStart(selected.id)" pip-scroll-container="pipScrollContainer" pip-drop-success="onDropComplete($index, $data, $event, selected.id)"><div ng-class="{\'put_place\': selected.drag}"></div><div class="pip-checklist-item-body" pip-cancel-drag="true" ng-class="{ \'select-active-item\': isSelectedItem($index) }" layout="row" layout-align="start start"><div class="pip-checklist-button" pip-cancel-drag="true"><md-button pip-drag-handle="" class="pip-icon-checklist-button md-icon-button no-ripple-container" aria-label="REARRANGE" tabindex="-1" pip-mobile-mousedown="onDownDragg(item)" pip-mobile-mouseup="onDraggEnd()" ng-if="pipDraggable && checklistContent.length > 2 && !item.empty" ng-class="checklistContent.length > 1 ? \'cursor-move\' : \'cursor-default\'" ng-disabled="ngDisabled()"><md-icon class="text-grey" md-svg-icon="icons:vhandle"></md-icon></md-button></div><div class="pip-checklist-button" style="overflow: hidden" pip-cancel-drag="true"><div class="pip-checklist-button-container"><md-button class="pip-icon-checklist-button md-icon-button" ng-show="item.empty" ng-disabled="ngDisabled()" md-ink-ripple="" ng-click="onAddItem()" tabindex="-1" aria-label="PLUS"><md-icon class="text-grey" md-svg-icon="icons:plus"></md-icon></md-button><md-checkbox ng-model="item.checked" ng-show="!item.empty" aria-label="COMPLETE" pip-cancel-drag="true" ng-focus="onItemFocus($index)" ng-change="onChecked(item)" ng-disabled="ngDisabled()"></md-checkbox></div></div><div class="pip-checklist-text" flex="" pip-cancel-drag="true"><md-input-container md-no-float="" flex=""><textarea ng-model="item.text" name="{{\'text\' + $index}}" aria-label="TEXT" class="pip-text-checkbox" ng-focus="onItemFocus($index)" ng-change="onChangeItem($index)" ng-keydown="onTextareaKeyDown($event, $index, item)" placeholder="{{::\'TEXT\' | translate}}" id="{{\'check-item-text-\' + selected.id + \'-\' + $index}}" ng-disabled="ngDisabled()">\n                    </textarea></md-input-container></div><div class="pip-checklist-button" pip-cancel-drag="true"><md-button class="pip-icon-checklist-button md-icon-button" md-ink-ripple="" ng-click="onDeleteItem($index, item)" ng-disabled="ngDisabled()" tabindex="-1" ng-focus="onItemFocus($index)" ng-show="isSelectedItem($index)" aria-label="DELETE-ITEM"><md-icon class="text-grey" md-svg-icon="icons:cross-circle"></md-icon></md-button></div></div></div><div id="{{\'check-item-empty-\' + selected.id}}" class="pip-empty-text" pip-drag="false" pip-drop="true" pip-drop-success="onDropComplete(checklistContent.length, $data, $event, selected.id)"><div ng-class="{\'put_place\': selected.drag}"></div></div></div>')}])}(),function(e){try{e=angular.module("pipComposite.Templates")}catch(t){e=angular.module("pipComposite.Templates",[])}e.run(["$templateCache",function(e){e.put("checklist_view/checklist_view.html",'<div ng-repeat="item in checklistContent track by $index"><div class="pip-checklist-item" layout="row" layout-align="start start"><div class="pip-checklist-icon"><md-checkbox ng-model="item.checked" ng-click="onClick($event, item)" aria-label="COMPLETE" ng-disabled="ngDisabled()"></md-checkbox></div><div class="pip-checklist-text" flex=""><pip-markdown pip-text="item.text" pip-rebind="true" ng-disabled="true"></pip-markdown></div></div></div>')}])}(),function(e){try{e=angular.module("pipComposite.Templates")}catch(t){e=angular.module("pipComposite.Templates",[])}e.run(["$templateCache",function(e){e.put("composite_edit/composite_edit.html",'<div class="divider-top"><div class="pip-composite-body" ng-show="compositeContent.length != 0" ng-class="{\'drag-active\': selected.drag}"><div class="pip-composite-item" ng-repeat="obj in compositeContent track by obj.id" ng-mousedown="onClick($event, $index, obj)" ng-class="{\'selected-content\': isSelectedSection($index, obj), \'composite-animate\': !obj.empty && compositeContent.length > 1}" ng-keyup="onKeyUp($event)" ng-keydown="onKeyDown($event, $index, obj)" pip-drag="compositeContent.length > 1 && selected.drag" pip-touch-delay="10" pip-drag-data="obj" pip-scroll-container="pipScrollContainer" pip-drop="true" pip-force-touch="true" pip-drag-stop="onStop(selected.id)" pip-drag-start="onStart(selected.id)" pip-drop-success="onDropComplete($index, $data, $event, selected.id)" id="{{\'composite-item-\' + selected.id + \'-\' + $index}}"><div class="putt_box"></div><div class="pip-section-header" ng-if="!obj.empty" layout="row" layout-align="start center"><div class="w38"></div><md-button class="md-icon-button md-icon-button-little icon-rearrange-btn no-ripple-container rm8 cursor-move" ng-if="!ngDisabled() && compositeContent.length > 1" pip-drag-handle="" pip-mobile-mousedown="onDownDragg($event, obj)" pip-mobile-mouseup="onDraggEnd()" tabindex="-1" aria-label="COMPOSITE-DRAGG" ng-hide="compositeContent.length == 1"><md-icon class="composite-icon cursor-move" md-svg-icon="icons:handle"></md-icon></md-button><div><md-button class="md-icon-button md-icon-button-little rm8" ng-click="onDeleteItem($index)" ng-disabled="ngDisabled()" aria-label="COMPOSITE-DELETE"><md-icon class="composite-icon" md-svg-icon="icons:cross"></md-icon></md-button></div></div><div class="pip-section-content rp24-flex lp24-flex tp16 bp16" ng-if="obj.type == \'text\'" pip-cancel-drag="true"><md-input-container class="p0 m0 w-stretch" md-no-float=""><textarea ng-model="obj.text" aria-label="text" placeholder="{{ isFirst ? compositePlaceholder : \'TEXT\' | translate}}" id="{{\'composite-item-text-\' + selected.id + \'-\' + $index}}" ng-change="onContentChange(obj)" pip-cancel-drag="true" ng-disabled="ngDisabled()">\n                            </textarea></md-input-container></div><div class="pip-section-content rp24-flex lp24-flex vp20" ng-if="obj.type == \'pictures\'" pip-cancel-drag="true"><pip-picture-list-edit class="w-stretch" pip-cancel-drag="true" pip-picture-ids="obj.pic_ids" pip-changed="onContentChange(obj)" pip-created="obj.pictures = $event.sender" pip-added-picture="addedContent" ng-disabled="ngDisabled()"></pip-picture-list-edit></div><div class="pip-section-content rp24-flex lp24-flex vp20" ng-if="obj.type == \'documents\'" pip-cancel-drag="true"><pip-document-list-edit class="w-stretch" pip-documents="obj.docs" pip-cancel-drag="true" pip-changed="onContentChange(obj)" pip-created="obj.documents = $event.sender" pip-added-document="addedContent" ng-disabled="ngDisabled()"></pip-document-list-edit></div><div class="pip-section-content" ng-if="obj.type == \'checklist\'" pip-cancel-drag="true" layout="row" layout-align="start center"><pip-checklist-edit pip-options="obj.checklist" pip-draggable="isActiveChecklist(obj)" pip-changed="onContentChange(obj)" ng-disabled="ngDisabled()" pip-scroll-container="{{pipScrollContainer}}" pip-rebind="true"></pip-checklist-edit></div><div class="pip-section-content vp20 rp24-flex lp24-flex" ng-if="obj.type == \'location\'" pip-cancel-drag="true"><pip-location-edit class="pip-location-attachments w-stretch" pip-location-name="obj.loc_name" pip-location-pos="obj.loc_pos" pip-cancel-drag="true" pip-location-holder="pipLocationHolder" pip-changed="onContentChange(obj)" ng-disabled="ngDisabled()"></pip-location-edit></div><div class="pip-section-content bp16-flex rp24-flex lp24-flex tp20" ng-if="obj.type == \'time\'" pip-cancel-drag="true"><pip-time-edit class="w-stretch" pip-start-date="obj.start" pip-end-date="obj.end" pip-size="$sizeGtSmall" pip-changed="onContentChange(obj)" ng-disabled="ngDisabled()" pip-start-label="{{ \'COMPOSITE_START_TIME\' | translate }}" pip-end-label="{{ \'COMPOSITE_END_TIME\' | translate }}"></pip-time-edit></div></div><div class="pip-composite-item w-stretch" pip-drag="false" pip-drop="true" pip-drop-success="onDropComplete(compositeContent.length, $data, $event, selected.id)" pip-drag-stop="onStop(selected.id)" pip-drag-start="onStart(selected.id)" id="{{\'pip-composite-last-\' + selected.id}}"><div class="putt_box"></div><div class="pip-section-content h24" style="border: 0px!important;"></div></div></div></div>')}])}(),function(e){try{e=angular.module("pipComposite.Templates")}catch(t){e=angular.module("pipComposite.Templates",[])}e.run(["$templateCache",function(e){e.put("composite_summary/composite_summary.html",'<div ng-repeat="item in compositeContent track by $index"><div class="pip-composite-text" ng-if="item.type == \'text\' && item.text"><pip-markdown pip-text="item.text" pip-line-count="{{textSize}}" pip-rebind="true" ng-disabled="true"></pip-markdown></div><div ng-if="item.type == \'pictures\' && item.pic_ids.length > 0" ng-class="compositeContent[$index - 1].type != \'pictures\' ? compositeContent[$index + 1].type != \'pictures\' ? \'tm16 bm16\' : \'tm16 bm0\' : compositeContent[$index + 1].type != \'pictures\' ? \'tm8 bm16\' : \'tm8 bm0\'" class="pip-composite-pictures"><pip-collage ng-if="rebind" pip-picture-ids="item.pic_ids" pip-unique-code="item.id" pip-multiple="true" pip-open="disableControl" pip-rebind="true" ng-disabled="disableControl"></pip-collage></div><div ng-if="item.type == \'documents\' && item.docs.length > 0" class="pip-composite-documents" layout="row" flex=""><pip-document-list flex="" pip-documents="item.docs" pip-rebind="true" pip-document-icon="true" pip-collapse="true" ng-disabled="disableControl"></pip-document-list></div><div ng-if="item.type == \'checklist\' && item.checklist.length > 0" class="pip-composite-checklist"><pip-checklist-view pip-options="item.checklist" pip-changed="onContentChange()" pip-rebind="true" pip-collapse="true" ng-disabled="disabledChecklist"></pip-checklist-view></div><div class="pip-composite-location" layout="row" layout-align="start center" flex="" ng-if="item.type == \'location\' && (item.loc_pos || item.loc_name)"><pip-location pip-location-name="item.loc_name" pip-location-pos="item.loc_pos" pip-collapse="true" pip-show-location-icon="true" ng-disabled="disableControl" pip-rebind="true" flex=""></pip-location></div><div class="pip-composite-time" ng-if="item.type == \'time\' && (item.start || item.end)" layout="row" layout-align="start center" flex=""><md-icon md-svg-icon="icons:time" class="rm24 lm0"></md-icon><pip-time-view pip-start-date="item.start" pip-end-date="item.end" pip-rebind="true" ng-disabled="disableControl"></pip-time-view></div></div>')}])}(),function(e){try{e=angular.module("pipComposite.Templates")}catch(t){e=angular.module("pipComposite.Templates",[])}e.run(["$templateCache",function(e){e.put("composite_toolbar/composite_toolbar.html",'<div layout="row" layout-align="start start" flex=""><md-button class="pip-composite-button" ng-if="!emptyState" ng-class="{ \'remove-item\': !emptyState , \'new-item\': !emptyState }" ng-click="onAddItem(\'text\');" aria-label="COMPOSITE-BUTTON-TEXT" ng-disabled="ngDisabled()"><md-icon class="icon-text-block" md-svg-icon="icons:text"></md-icon><md-tooltip>{{::\'TEXT\'| translate}}</md-tooltip></md-button><md-button ng-if="toolbarButton.checklist" ng-click="onAddItem(\'checklist\')" ng-disabled="ngDisabled()" class="pip-composite-button" aria-label="COMPOSITE-BUTTON-CHECKLIST"><md-icon class="icon-checkbox-on" md-svg-icon="icons:checkbox-on"></md-icon><md-tooltip>{{::\'CHECKLIST\'| translate}}</md-tooltip></md-button><md-button ng-if="toolbarButton.picture" ng-click="onAddItem(\'pictures\')" ng-disabled="ngDisabled()" class="pip-composite-button" aria-label="COMPOSITE-BUTTON-PICTURES"><md-icon class="icon-camera" md-svg-icon="icons:camera"></md-icon><md-tooltip>{{::\'PICTURE\'| translate}}</md-tooltip></md-button><md-button ng-click="onAddItem(\'documents\')" ng-if="toolbarButton.document" ng-disabled="ngDisabled()" class="pip-composite-button" aria-label="COMPOSITE-BUTTON-DOCUMENTS"><md-icon class="icon-document" md-svg-icon="icons:document"></md-icon><md-tooltip>{{::\'DOCUMENT\'| translate}}</md-tooltip></md-button><md-button ng-click="onAddItem(\'location\')" ng-if="toolbarButton.location" ng-disabled="ngDisabled()" class="pip-composite-button" aria-label="COMPOSITE-BUTTON-LOCATIONS"><md-icon class="icon-location" md-svg-icon="icons:location"></md-icon><md-tooltip>{{::\'LOCATION\'| translate}}</md-tooltip></md-button><md-button ng-click="onAddItem(\'time\')" ng-if="toolbarButton.event" ng-disabled="ngDisabled()" class="pip-composite-button" aria-label="COMPOSITE-BUTTON-TIME"><md-icon class="icon-time" md-svg-icon="icons:time"></md-icon><md-tooltip>{{::\'TIME\'| translate}}</md-tooltip></md-button></div>')}])}(),function(e){try{e=angular.module("pipComposite.Templates")}catch(t){e=angular.module("pipComposite.Templates",[])}e.run(["$templateCache",function(e){e.put("composite_view/composite_view.html",'<div ng-repeat="item in compositeContent track by $index"><div class="pip-composite-text lp24-flex rp24-flex" ng-if="item.type == \'text\' && item.text" ng-class="{\'bm16\': $last}"><pip-markdown pip-text="item.text" pip-rebind="true" ng-disabled="true"></pip-markdown></div><div ng-if="item.type == \'pictures\' && item.pic_ids.length > 0" ng-class="compositeContent[$index - 1].type != \'pictures\' ? compositeContent[$index + 1].type != \'pictures\' ? \'tm16 bm16\' : \'tm16 bm0\' : compositeContent[$index + 1].type != \'pictures\' ? \'tm8 bm16\' : \'tm8 bm0\'" class="pip-composite-pictures lp24-flex rp24-flex"><pip-collage ng-if="rebind" pip-picture-ids="item.pic_ids" pip-unique-code="item.id" pip-multiple="true" pip-open="true" pip-rebind="true" ng-disabled="ngDisabled()"></pip-collage></div><div ng-if="item.type == \'documents\' && item.docs.length > 0" class="pip-composite-documents" layout="row" layout-align="start start" flex=""><pip-document-list pip-documents="item.docs" pip-document-icon="true" pip-rebind="true" ng-disabled="ngDisabled()"></pip-document-list></div><div ng-if="item.type == \'checklist\' && item.checklist.length > 0" class="pip-composite-checklist lp24-flex rp24-flex"><pip-checklist-view pip-options="item.checklist" pip-changed="onContentChange()" pip-rebind="true" ng-disabled="isDisabled()"></pip-checklist-view></div><div class="pip-composite-location" layout="row" layout-align="start start" flex="" ng-if="item.type == \'location\' && (item.loc_pos || item.loc_name)"><pip-location pip-location-name="item.loc_name" pip-location-pos="item.loc_pos" pip-show-location-icon="true" pip-collapse="false" ng-disabled="ngDisabled()" pip-rebind="true" flex=""></pip-location></div><div class="pip-composite-time lp24-flex rp24-flex" ng-if="item.type == \'time\'" layout="row" layout-align="start center" flex=""><md-icon md-svg-icon="icons:time" class="lm0"></md-icon><pip-time-view pip-start-date="item.start" pip-end-date="item.end" pip-rebind="true" ng-disabled="ngDisabled()"></pip-time-view></div></div>')}])}(),function(e){try{e=angular.module("pipComposite.Templates")}catch(t){e=angular.module("pipComposite.Templates",[])}e.run(["$templateCache",function(e){e.put("content_switch/content_switch.html",'<md-button ng-click="showPictures = !showPictures; onButtonClick(\'pictures\')" aria-label="showPictures" class="md-icon-button" ng-show="showIconPicture" ng-disabled="transaction.busy()"><md-icon class="active-camera" xng-class="{ \'active-camera\': showPictures }" md-svg-icon="icons:camera"></md-icon></md-button><md-button ng-click="showDocuments = !showDocuments; onButtonClick(\'documents\')" aria-label="showDocuments" class="md-icon-button" ng-show="showIconDocument" ng-disabled="transaction.busy()"><md-icon ng-class="{ \'active-document\': showDocuments }" md-svg-icon="icons:document"></md-icon></md-button><md-button ng-click="showEvent = !showEvent; onButtonClick(\'event\')" aria-label="showEvent" class="md-icon-button" ng-show="showIconEvent" ng-disabled="transaction.busy()"><md-icon ng-class="{ \'active-time\': showEvent }" md-svg-icon="icons:time"></md-icon></md-button><md-button ng-click="showLocation = !showLocation; onButtonClick(\'location\')" aria-label="showLocation" class="md-icon-button" ng-show="showIconLocation" ng-disabled="transaction.busy()"><md-icon ng-class="{ \'active-location\': showLocation }" md-svg-icon="icons:location"></md-icon></md-button>\'')}])}(),function(){"use strict";var e=angular.module("pipChecklistEdit",["pipCore","pipComposite.Templates"]);e.directive("pipChecklistEdit",function(){return{restrict:"EA",replace:!1,scope:{ngDisabled:"&",pipChanged:"=",pipDraggable:"=",pipOptions:"=",pipScrollContainer:"@"},templateUrl:"checklist_edit/checklist_edit.html",controller:"pipChecklistEditController"}}),e.controller("pipChecklistEditController",["$scope","$element","$attrs","$document","pipUtils","$rootScope",function(e,t,i,o,n,c){function p(e){if(e.selectionStart)return e.selectionStart;if(o.selection){e.focus();var t=o.selection.createRange();if(null==t)return 0;var i=e.createTextRange(),n=i.duplicate();return i.moveToBookmark(t.getBookmark()),n.setEndPoint("EndToStart",i),n.text.length}return 0}function s(){return e.ngDisabled?e.ngDisabled():!1}function l(t){s()||(e.selected.index=t)}function d(t){var i;try{i=e.checklistContent[t].empty}catch(o){i=!0}return e.selected.index==t&&e.pipDraggable&&!i}function a(e,t,i){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,i);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",i),o.moveStart("character",t),o.select()}}function r(e,t){a(e,t,t)}function m(t,i,o){if(!s()&&-1!=e.selected.index){if(t&&t.target){var n=p(t.target);if(void 0!==t.target.value)var c=t.target.value.length}if(e.selected.index>0&&""!=o.text&&0==n&&8==t.keyCode&&!t.ctrlKey&&!t.shiftKey){if(!o.empty){var l=e.checklistContent[e.selected.index-1].text.length;e.checklistContent[e.selected.index-1].text=e.checklistContent[e.selected.index-1].text+o.text,e.selected.index-=1,e.checklistContent.splice(e.selected.index+1,1),e.onChecklistChange(),E(e.selected.index,l)}return t&&t.stopPropagation(),!1}if(!(""!=o.text||8!=t.keyCode&&46!=t.keyCode||t.ctrlKey||t.shiftKey))return o.empty||y(i,o),t&&t.stopPropagation(),!1;if(!(13!=t.keyCode&&45!=t.keyCode||t.ctrlKey||t.shiftKey)){if(void 0!==n&&0==n)return e.selected.index>0?$("",e.selected.index-1):(e.selected.index=-1,$("",-1)),t&&t.stopPropagation(),t&&t.preventDefault(),!1;if(c&&n&&c==n)return o.empty||$("",e.selected.index),t&&t.stopPropagation(),t&&t.preventDefault(),!1;if(c&&n&&c>n){if(!o.empty){var d,a;d=o.text.substring(0,n),a=o.text.substring(n),o.text=d,$(a,e.selected.index)}return t&&t.stopPropagation(),t&&t.preventDefault(),!1}return t&&t.preventDefault(),!1}return e.checklistContent.length>1&&38==t.keyCode&&!t.ctrlKey&&!t.shiftKey?(t&&t.stopPropagation(),t&&t.preventDefault(),void 0!==n&&void 0!==c&&n==c?0==e.selected.index?(e.selected.index=e.checklistContent.length-1,E(e.selected.index,0)):(e.selected.index-=1,E(e.selected.index,0)):E(e.selected.index,c),!1):e.checklistContent.length>1&&40==t.keyCode&&!t.ctrlKey&&!t.shiftKey?(t&&t.stopPropagation(),t&&t.preventDefault(),void 0!==n&&void 0!==c&&n==c?e.selected.index>=e.checklistContent.length-1?(e.selected.index=0,E(e.selected.index,0)):(e.selected.index+=1,E(e.selected.index,0)):E(e.selected.index,c),!1):o.empty||46!=t.keyCode||!t.ctrlKey||t.shiftKey?32==t.keyCode&&t.ctrlKey&&!t.shiftKey?(t&&t.stopPropagation(),t&&t.preventDefault(),o&&(o.checked=!o.checked,e.onChecklistChange()),!1):void 0:(t&&t.stopPropagation(),t&&t.preventDefault(),y(i,o),!1)}}function u(){$("",e.selected.index-1)}function g(t){t>-1&&e.checklistContent[t]&&e.checklistContent[t].empty&&e.checklistContent[t].empty&&(e.checklistContent[t].empty=!1,e.checklistContent.push(S("",!0))),e.onChecklistChange()}function h(t,i){s()||(e.selected.index=i)}function C(t,i){s()||(e.selected.index=i)}function b(t,i,o,n){if(e.selected.id==n&&e.selected.drag){var c=t,p=e.selected.index,s=_.cloneDeep(e.checklistContent);if(0!=p||1!=t){if(p>c){c>s.length-1&&(c=s.length-1);for(var l=0;p-c>l;l++)s[p-l]=s[p-l-1];s[c]=i}if(c>p){c-=1;for(var l=0;c-p>l;l++)s[p+l]=s[p+l+1];s[c]=i}e.selected.index=c}e.checklistContent=s,e.onChecklistChange()}}function f(){M(),e.isWidth=!0}function v(t){setTimeout(function(){e.selected.drag=e.selected.dragInit,e.selected.dragId=0,e.$apply()},50),e.isWidth&&(P(),e.isWidth=!1)}function k(t){e.selected.isChanged=!0,t&&t!=e.selected.dragId&&(e.selected.drag=!1)}function x(t){e.pipDraggable&&e.checklistContent.length>2&&!t.empty&&(c.$broadcast("onChecklistDrag"),e.selected.dragId=e.selected.id)}function y(t,i){if(1==e.checklistContent.length)e.checklistContent[0].text="",e.checklistContent[0].checked=!1,e.checklistContent[0].empty=!0,e.selected.index=0;else{if(!(t>=0&&t<=e.checklistContent.length))return;e.checklistContent.splice(t,1)}e.selected.index>=e.checklistContent.length&&(e.selected.index=e.checklistContent.length-1),E(e.selected.index,0),e.onChecklistChange()}function T(t){e.onChecklistChange()}function w(){e.selected.isChanged=!0;var t,i=[];for(t=0;t<e.checklistContent.length;t++)e.checklistContent[t]&&!e.checklistContent[t].empty&&i.push({checked:e.checklistContent[t].checked,text:e.checklistContent[t].text});e.pipOptions=i}function D(){w(),e.pipChanged&&e.pipChanged()}function E(t,i){t>-1&&setTimeout(function(){var o=angular.element("#check-item-text-"+e.selected.id+"-"+t);o&&(o.focus(),void 0!==i&&o[0]&&r(o[0],i))},50)}function $(t,i){var o=S(t,!1);i>-1&&(e.selected.index=i),e.checklistContent.length<2?e.checklistContent.unshift(o):e.checklistContent.splice(e.selected.index+1,0,o),e.selected.index+=1,E(e.selected.index),e.onChecklistChange()}function S(e,t){return{checked:!1,text:e||"",empty:t}}function I(){return+new Date}function O(){e.selected.index=0,e.checklistContent=[],e.checklistContent.push(S("",!0))}function B(t){!t||t.length<1?O():(e.checklistContent=[],_.each(t,function(t){e.checklistContent.push(t)}),e.checklistContent.push(S("",!0)))}function P(){var t=angular.element("#check-item-"+ +e.selected.id+"-"+e.selected.index);t.css("width","none"),t.css("max-width","none")}function M(){if(!e.isWidth){var t=angular.element("#check-item-empty-"+e.selected.id),i=t.width(),o=angular.element("#check-item-"+e.selected.id+"-"+e.selected.index);o&&(o.css("width",i+"px"),o.css("max-width",i+"px"))}}e.selected={},e.selected.index=0,e.selected.drag=e.pipDraggable,e.selected.dragInit=e.pipDraggable,e.selected.dragId=0,e.selected.id=I(),e.selected.isChanged=!1,B(e.pipOptions),e.onTextareaKeyDown=m,e.onAddItem=u,e.onChangeItem=g,e.onClick=h,e.onTextAreaClick=C,e.onDropComplete=b,e.onDeleteItem=y,e.onChecked=T,e.updateContents=w,e.onItemFocus=l,e.onMove=f,e.onStart=k,e.onStop=v,e.isDisabled=s,e.onDownDragg=x,e.isSelectedItem=d,n.toBoolean(i.pipRebind)&&e.$watchCollection("pipOptions",function(t){e.selected.isChanged?e.selected.isChanged=!1:B(e.pipOptions)}),n.toBoolean(i.pipRebind)&&e.$watchCollection("pipDraggable",function(t){e.pipDraggable=t}),e.onChecklistChange=_.debounce(D,200),t.addClass("pip-checklist-edit")}])}(),function(){"use strict";var e=angular.module("pipChecklistView",["pipCore","pipComposite.Templates"]);e.directive("pipChecklistView",function(){return{restrict:"EA",replace:!1,scope:{ngDisabled:"&",pipChanged:"&",pipOptions:"="},templateUrl:"checklist_view/checklist_view.html",controller:"pipChecklistViewController"}}),e.controller("pipChecklistViewController",["$scope","$element","$attrs","pipUtils",function(e,t,i,o){function n(){e.selected.isChanged=!0,e.pipOptions=e.checklistContent}function c(){n(),e.pipChanged&&e.pipChanged()}function p(){e.checklistContent=[]}function s(t){return!t||t.length<1?void p():(e.checklistContent=[],void _.each(t,function(t){e.checklistContent.push(t)}))}function l(t,i){t&&t.stopPropagation(),e.ngDisabled&&e.ngDisabled()||c()}e.disableControl=0!=o.toBoolean(e.ngDisabled()),e.rebind=o.toBoolean(i.pipRebind),e.selected={},e.selected.isChanged=!1,s(e.pipOptions),t.addClass("pip-checklist-view"),o.toBoolean(i.pipRebind)&&e.$watchCollection("pipOptions",function(t){e.selected.isChanged?e.selected.isChanged=!1:s(e.pipOptions)}),e.updateContents=n,e.onClick=l}])}(),function(){"use strict";var e=angular.module("pipCompositeSummary",["pipCore","pipDocuments","pipLocations","pipPictures","pipComposite.Templates"]);e.directive("pipCompositeSummary",function(){return{restrict:"EA",scope:{pipContents:"=",pipChecklistSize:"=",pipTextSize:"=",pipPrimaryBlockLimit:"=",pipSecondaryBlockLimit:"=",pipSecondaryBlockTypes:"="},templateUrl:"composite_summary/composite_summary.html",controller:"pipCompositeSummaryController"}}),e.controller("pipCompositeSummaryController",["$scope","$element","$attrs","pipUtils",function(e,t,i,o){function n(e,t){t&&_.each(e,function(e){e&&"checklist"==e.type&&(e.checklist=_.take(e.checklist,t))})}function c(t){var i=[],o=0;return _.each(t,function(t){return e.primaryBlockLimit>=0&&o>=e.primaryBlockLimit?i:void(e.secondaryBlockTypes.indexOf(t.type)<0&&(i.push(t),o+=1))}),i}function p(t,i){var o,n=e.secondaryBlockLimit<0?t.length:e.secondaryBlockLimit,c=[];for(o=0;o<t.length&&!(i.indexOf(t[o].type)>-1&&(c.push(t[o]),c.length>=n));o++);return c}function s(t){if(!t||t.length<1)return void l();var i=c(t);0==i.length&&(i=p(t,e.secondaryBlockTypes)),n(i,e.checklistSize);var o=0;_.each(i,function(e){e.id=o,o++}),e.compositeContent=i}function l(){e.compositeContent=[]}e.rebind=o.toBoolean(i.pipRebind),e.disableControl=!0,e.disabledChecklist=!0,e.secondaryBlockTypes=void 0!==e.pipSecondaryBlockTypes&&Array.isArray(e.pipSecondaryBlockTypes)?e.pipSecondaryBlockTypes:["checklist","documents","location","time"],e.textSize=void 0!==e.pipTextSize&&e.pipTextSize>0?e.pipTextSize:0,e.secondaryBlockLimit=void 0!==e.pipSecondaryBlockLimit&&e.pipSecondaryBlockLimit>0?e.pipSecondaryBlockLimit:-1,e.checklistSize=void 0!==e.pipChecklistSize&&e.pipChecklistSize>0?e.pipChecklistSize:0,e.primaryBlockLimit=void 0!==e.pipPrimaryBlockLimit?e.pipPrimaryBlockLimit:-1,s(e.pipContents),o.toBoolean(i.pipRebind)&&e.$watchCollection("pipContents",function(t){if(!Array.isArray(e.pipContents))throw new Error("Error: Attribute pip-contents must be array!");s(e.pipContents)}),t.addClass("pip-composite-summary")}])}(),function(){"use strict";var e=angular.module("pipCompositeEdit",["pipCore","pipDocuments","pipLocations","pipPictures","pipComposite.Templates"]);e.config(["pipTranslateProvider",function(e){e.translations("en",{COMPOSITE_TITLE:"What's on your mind?",COMPOSITE_PLACEHOLDER:"Type text ...",COMPOSITE_START_TIME:"Start time",COMPOSITE_END_TIME:"End time"}),e.translations("ru",{COMPOSITE_TITLE:"Что у вас на уме?",COMPOSITE_PLACEHOLDER:"Введите текст ...",COMPOSITE_START_TIME:"Время начала",COMPOSITE_END_TIME:"Время окончания"})}]),e.directive("pipCompositeEdit",function(){return{restrict:"EA",replace:!1,scope:{ngDisabled:"&",pipChanged:"&",pipContents:"=",compositeId:"=pipCompositeId",pipCompositePlaceholder:"=",pipScrollContainer:"@",pipAddedContent:"&"},templateUrl:"composite_edit/composite_edit.html",controller:"pipCompositeEditController"}}),e.controller("pipCompositeEditController",["$scope","$element","$attrs","$rootScope","pipUtils","pipTranslate","$document",function(e,t,i,o,n,c,p){function s(t){return t.id==e.selected.index}function l(){e.selected.isChanged=!0,e.pipContents=e.compositeContent}function d(t){if(t.length<1)return null;var i=t.parent();if(i[0]&&i[0].id&&i[0].id.indexOf("composite-item-"+e.selected.id)>-1){var o=i[0].id.split("-"),n=parseInt(o[o.length-1],10);return n}return d(i)}function a(t){9==t.keyCode&&setTimeout(function(){var t=angular.element(p[0].activeElement),i=d(t);null!=i&&(e.selected.index=i),e.$apply(e.selected.index=e.compositeContent[i].id)},50)}function r(t,i,o){return e.ngDisabled()?void 0:o&&!o.empty&&46==t.keyCode&&!t.ctrlKey&&t.shiftKey?(t&&t.stopPropagation(),t&&t.preventDefault(),i>-1&&u(i),!1):void 0}function m(){l(),e.pipChanged&&e.pipChanged()}function u(t){0>t||0==e.compositeContent.length||(1==e.compositeContent.length?(e.compositeContent[0]={empty:!0,id:D(),type:"text",text:"",docs:[],pic_ids:[],loc_pos:null,loc_name:"",start:null,end:null,checklist:[]},e.selected.index=e.compositeContent[0].id,y(0),e.isFirst=!0,I()):(t>=0&&t<e.compositeContent.length&&e.compositeContent.splice(t,1),t==e.compositeContent.length?e.selected.index=e.compositeContent[e.compositeContent.length-1].id:e.selected.index=e.compositeContent[t].id,y()),I(),e.onCompositeChange())}function g(t){t&&t.empty&&t.text&&(t.empty=!1,e.isFirst=!1,I()),e.ngDisabled()||e.onCompositeChange()}function h(t,i){return e.selected.index==i.id&&!i.empty}function C(){e.selected.drag=!0}function b(t){t&&t!=e.selected.dragId&&(e.selected.drag=!1)}function f(t){setTimeout(function(){e.selected.drag=!0,e.selected.dragId=0,e.$apply()},500)}function v(t,i){e.ngDisabled&&e.ngDisabled()||(e.selected.dragId=e.selected.id,e.selected.drag=!0,e.selected.index=i.id)}function k(t,i,o){return e.ngDisabled&&e.ngDisabled()?void 0:(e.selected.event="onClick",t&&t.target&&t.target.tagName&&("INPUT"==t.target.tagName||"TEXTAREA"==t.target.tagName)?void(e.selected.index=o.id):void(e.selected.index==o.id&&"checklist"==o.type&&o.checklist.length>0||e.selected.index==o.id&&"location"==o.type||(e.selected.index=o.id,y())))}function x(t,i,o,n){if(n!=e.selected.id||!i||!i.type)return void(e.compositeContent=_.cloneDeep(e.pipContents));var c=t,p=_.findIndex(e.compositeContent,{id:i.id});if(0!=p||1!=t){if(p>c){c>e.compositeContent.length-1&&(c=e.compositeContent.length-1);for(var s=0;p-c>s;s++)e.compositeContent[p-s]=e.compositeContent[p-s-1];e.compositeContent[c]=i}if(c>p){c-=1;for(var s=0;c-p>s;s++)e.compositeContent[p+s]=e.compositeContent[p+s+1];e.compositeContent[c]=i}e.selected.index=e.compositeContent[c].id}y(),e.onCompositeChange()}function y(t){if(t||(t=_.findIndex(e.compositeContent,{id:e.selected.index})),!(0>t)){var i=e.compositeContent[t];if(!_.isEmpty(i))switch(i.type){case"pictures":setTimeout(function(){var i=angular.element("#composite-item-"+e.selected.id+"-"+t+" button.pip-picture-upload");i&&!i.is(":focus")&&i.focus()},50);break;case"documents":setTimeout(function(){var i=angular.element("#composite-item-"+e.selected.id+"-"+t+" button.pip-document-upload");i&&!i.is(":focus")&&i.focus()},50);break;case"location":setTimeout(function(){var i=angular.element("#composite-item-"+e.selected.id+"-"+t+" .pip-location-empty  button");i&&!i.is(":focus")&&i.focus()},50);break;case"time":}}}function T(){e.compositePlaceholder=void 0===e.pipCompositePlaceholder||null===e.pipCompositePlaceholder?c.translate("COMPOSITE_PLACEHOLDER"):c.translate(e.pipCompositePlaceholder)}function w(t,i){if(!(_.indexOf(P,t)<0)){var o={id:D(),type:t,text:"text"==t?i:"",docs:"documents"==t&&i?i:[],pic_ids:"pictures"==t&&i?i:[],loc_pos:"location"==t&&i?i.loc_pos:null,loc_name:"location"==t&&i?i.loc_name:"",start:"time"==t&&i?i.start:null,end:"time"==t&&i?i.end:null,checklist:"checklist"==t&&i?i:[]},n=_.findIndex(e.compositeContent,{id:e.selected.index});n=0>n?0:n,1==e.compositeContent.length&&e.compositeContent[0].empty?e.compositeContent[0]=o:(e.compositeContent.splice(n+1,0,o),n+=1),e.selected.index=o.id,y(),setTimeout(E(e.pipScrollContainer,"#composite-item-"+e.selected.id+"-"+n),1e3),e.isFirst=!1,I(),e.onCompositeChange()}
}function D(){var t=-1;return _.each(e.compositeContent,function(e){t<e.id&&(t=e.id)}),t+1}function E(e,t){e&&t&&setTimeout(function(){if($(t).position()){var i=Math.abs($(e).scrollTop()-$(t).position().top);if(!(20>i)){var o=$(e).scrollTop()+($(t).position().top-20);$(e).animate({scrollTop:o+"px"},300)}}},100)}function S(t){return!t||t.length<1?void O():(e.compositeContent=[],_.each(t,function(t){t.id=D(),e.compositeContent.push(t)}),e.isFirst=!1,void I())}function I(){e.compositeContent.length>2||o.$emit("pipCompositeNotEmpty",!e.isFirst)}function O(){e.compositeContent=[],e.compositeContent.push({empty:!0,id:D(),type:"text",text:"",docs:[],pic_ids:[],loc_pos:null,loc_name:"",start:null,end:null,checklist:[]}),e.isFirst=!0}function B(){return+new Date}var P=["time","text","pictures","documents","checklist","location"];e.selected={},e.selected.id=B(),e.selected.index=0,e.selected.drag=!0,e.selected.dragId=0,e.selected.isChanged=!1,e.toolbarButton={},e.rebind=n.toBoolean(i.pipRebind),e.disableControl=0!=n.toBoolean(e.ngDisabled()),e.addedContent=1==n.toBoolean(e.pipAddedContent()),S(e.pipContents),T(),o.$on("pipAddCompositeItem",function(t,i){e.compositeId?i.id&&i.id==e.compositeId&&w(i.type):w(i.type)}),n.toBoolean(i.pipRebind)&&(e.$watchCollection("pipContents",function(t,i){(!e.selected.isChanged||e.pipContents&&e.pipContents.length!=e.compositeContent.length)&&(S(e.pipContents),e.selected.isChanged=!1)}),e.$watch("pipCompositePlaceholder",function(e,t){e!==t&&T()})),t.addClass("pip-composite-edit"),e.onDeleteItem=u,e.onContentChange=g,e.isSelectedSection=h,e.onClick=k,e.onDownDragg=v,e.onDraggEnd=C,e.onDropComplete=x,e.onKeyUp=a,e.onKeyDown=r,e.onStart=b,e.onStop=f,e.isActiveChecklist=s,o.$on("onChecklistDrag",function(){e.selected.drag=!1,setTimeout(function(){e.selected.drag=!1,e.$apply()},0)}),o.$on("focusedComposite",function(){e.isFirst&&setTimeout(function(){var t=angular.element("#composite-item-text-"+e.selected.id+"-0");t&&!t.is(":focus")&&t.focus()},50)}),e.onCompositeChange=_.debounce(m,200)}])}(),function(){"use strict";var e=angular.module("pipCompositeToolbar",["pipCore","pipComposite.Templates"]);e.config(["pipTranslateProvider",function(e){e.translations("en",{TEXT:"Text",CHECKLIST:"Checklist",LOCATION:"Location",PICTURE:"Picture",TIME:"Time",DOCUMENT:"Document"}),e.translations("ru",{TEXT:"Текст",CHECKLIST:"Список",LOCATION:"Локация",PICTURE:"Изображение",TIME:"Время",DOCUMENT:"Document"})}]),e.directive("pipCompositeToolbar",function(){return{restrict:"EA",replace:!1,scope:{ngDisabled:"&",pipCompositeEmpty:"&",pipToolbarButton:"=",compositeId:"=pipCompositeId"},templateUrl:"composite_toolbar/composite_toolbar.html",controller:"pipCompositeToolbarController"}}),e.controller("pipCompositeToolbarController",["$scope","$element","$attrs","$rootScope","pipUtils",function(e,t,i,o,n){function c(t){o.$emit("pipAddCompositeItem",{type:t,id:e.compositeId})}function p(){null!==e.pipToolbarButton&&void 0!==e.pipToolbarButton?(e.toolbarButton.picture=e.pipToolbarButton.picture===!1?e.pipToolbarButton.picture:!0,e.toolbarButton.document=e.pipToolbarButton.document===!1?e.pipToolbarButton.document:!0,e.toolbarButton.location=e.pipToolbarButton.location===!1?e.pipToolbarButton.location:!0,e.toolbarButton.event=e.pipToolbarButton.event===!1?e.pipToolbarButton.event:!0,e.toolbarButton.checklist=e.pipToolbarButton.checklist===!1?e.pipToolbarButton.checklist:!0):(e.toolbarButton.picture=!0,e.toolbarButton.document=!0,e.toolbarButton.location=!0,e.toolbarButton.event=!0,e.toolbarButton.checklist=!0),e.toolbarButton.text=!0}e.toolbarButton={},e.emptyState=0!=n.toBoolean(e.pipCompositeEmpty()),e.disableControl=0!=n.toBoolean(e.ngDisabled()),p(),e.onAddItem=c,o.$on("pipCompositeNotEmpty",function(t,i){e.emptyState=!i}),t.addClass("pip-composite-toolbar")}])}(),function(){"use strict";var e=angular.module("pipCompositeView",["pipCore","pipDocuments","pipLocations","pipPictures","pipComposite.Templates"]);e.directive("pipCompositeView",function(){return{restrict:"EA",scope:{ngDisabled:"&",pipDisabledChecklist:"&",pipChanged:"&",pipContents:"="},templateUrl:"composite_view/composite_view.html",controller:"pipCompositeViewController"}}),e.controller("pipCompositeViewController",["$scope","$element","$attrs","pipUtils",function(e,t,i,o){function n(){return 1==o.toBoolean(e.pipDisabledChecklist())||1==o.toBoolean(e.ngDisabled())}function c(){e.selected.isChanged=!0,e.pipContents=e.compositeContent}function p(){s()}function s(){c(),e.pipChanged&&e.pipChanged()}function l(t){if(!t||t.length<1)return void d();e.compositeContent=[];var i=0;_.each(t,function(t){if("object"!=typeof t||null==t)throw new Error("Error: content error!");t.id=i,i++,e.compositeContent.push(t)})}function d(){e.compositeContent=[]}e.rebind=o.toBoolean(i.pipRebind),e.disableControl=0!=o.toBoolean(e.ngDisabled()),e.disabledChecklist=0!=o.toBoolean(e.pipDisabledChecklist()),e.selected={},e.selected.isChanged=!1,l(e.pipContents),e.onContentChange=p,e.isDisabled=n,o.toBoolean(i.pipRebind)&&e.$watchCollection("pipContents",function(t){Array.isArray(e.pipContents)&&(e.selected.isChanged?e.selected.isChanged=!1:l(e.pipContents))}),t.addClass("pip-composite-view")}])}(),function(){"use strict";var e=angular.module("pipContentSwitch",["pipComposite.Templates"]);e.directive("pipContentSwitch",["$parse",function(e){return{restrict:"EA",scope:!1,templateUrl:"content_switch/content_switch.html",link:function(t,i,o){function n(e){setTimeout(function(){var t=Math.abs($(l).scrollTop()-$(e).position().top);if(!(20>t)){var i=$(l).scrollTop()+($(e).position().top-20);$(l).animate({scrollTop:i+"px"},300)}},100)}function c(){null!==t.contentSwitchOption&&void 0!==t.contentSwitchOption?(t.showIconPicture=t.contentSwitchOption.picture?t.contentSwitchOption.picture:t.showIconPicture,t.showIconDocument=t.contentSwitchOption.document?t.contentSwitchOption.document:t.showIconDocument,t.showIconLocation=t.contentSwitchOption.location?t.contentSwitchOption.location:t.showIconLocation,t.showIconEvent=t.contentSwitchOption.event?t.contentSwitchOption.event:t.showIconEvent):(t.showIconPicture=!0,t.showIconDocument=!0,t.showIconLocation=!0,t.showIconEvent=!0)}function p(e){if(l)switch(e){case"event":t.showEvent&&n(".event-edit");break;case"documents":t.showDocuments&&n(".pip-document-list-edit");break;case"pictures":t.showPictures&&n(".pip-picture-list-edit");break;case"location":t.showLocation&&n(".pip-location-edit")}}var s=e(o.pipParentElementName),l=s(t);t.onButtonClick=p,c(),i.addClass("pip-content-switch")}}}])}(),function(){"use strict";var e=angular.module("pipMobileMousedown",[]);e.directive("pipMobileMousedown",function(){return function(e,t,i){t.bind("touchstart mousedown",function(t){e.$apply(i.pipMobileMousedown)})}})}(),function(){"use strict";var e=angular.module("pipMobileMouseup",[]);e.directive("pipMobileMouseup",function(){return function(e,t,i){t.bind("touchend mouseup",function(t){e.$apply(i.pipMobileMouseup)})}})}(),function(){"use strict";var e=angular.module("pipCompositeFocused",[]);e.directive("pipCompositeFocused",function(){return{restrict:"A",scope:!1,controller:"pipCompositeFocusedController"}}),e.controller("pipCompositeFocusedController",["$scope","$element","$rootScope",function(e,t,i){t.bind("touchstart mousedown",function(e){i.$broadcast("focusedComposite")})}])}();